---
import BaseLayout from "@layouts/BaseLayout.astro";
import HeroDiorama from "@components/HeroDiorama.astro";
import FaqSection from "@components/FaqSection.astro";
import FeatureShowcaseDynamicRatio from "@components/FeatureShowcaseDynamicRatio.astro";
import FeaturesSection from "@components/sections/FeaturesSection.astro";
import VerifactuSection from "@components/sections/VerifactuSection.astro";
import PricingSection from "@components/sections/PricingSection.astro";
import TeamSection from "@components/sections/TeamSection.astro";
import ContactSection from "@components/sections/ContactSection.astro";

const errCode = Astro.url.searchParams.get('contact_error') || '';
const messages: Record<string, string> = {
  MISSING_FIELDS: 'Rellena todos los campos.',
  INVALID_EMAIL: 'El email no parece v치lido.',
  SERVER_NOT_CONFIGURED: 'Configuraci칩n del correo incompleta.',
  SES_REJECTED: 'El correo fue rechazado por SES (sandbox o identidad).',
  SES_ACCESS_DENIED: 'Permisos SES insuficientes.',
  BAD_JSON: 'Formato de datos incorrecto.',
  UNSUPPORTED_MEDIA_TYPE: 'Formato de env칤o no soportado.',
  INTERNAL_ERROR: 'Error interno. Int칠ntalo m치s tarde.',
  METHOD_NOT_ALLOWED: 'M칠todo no permitido.'
};
const initialStatus = errCode ? (messages[errCode] || 'No se pudo enviar el mensaje.') : '';
const initialStatusClass = errCode ? 'status-error' : '';
const endpoint = import.meta.env.PUBLIC_CONTACT_ENDPOINT || '';
const turnstileKey = import.meta.env.PUBLIC_TURNSTILE_SITEKEY || '';

// Reutilizamos el mismo array que antes
const showcaseItems = [
  {
    title:"Personalizaci칩n Total de TePeuVe",
    text:"Adapta TePeuVe a tu forma de trabajar. Elige entre modo claro u oscuro, configura atajos y ajusta cada m칩dulo a tu negocio.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/claro_oscuro.png", dark: "/assets/features/claro_oscuro.png", alt: "Modo claro y oscuro" },
      { light: "/assets/features/ajustes.png", dark: "/assets/features/ajustes_oscuro.png", alt: "Panel de ajustes" },
      { light: "/assets/features/ajustes2.png", dark: "/assets/features/ajustes_oscuro2.png", alt: "Ajustes avanzados" },
      { light: "/assets/features/fidelizacion.png", dark: "/assets/features/fidelizacion_oscuro.png", alt: "Fidelizaci칩n de clientes" },
    ],
    alt:"Personalizaci칩n del TPV",
    mediaAnim:"zoom-in",
    contentAnim:"slide-left",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Gesti칩n de Caja y Control de Efectivo",
    text:"Control autom치tico de movimientos y arqueos r치pidos. Compatible con caj칩n portamonedas.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/arqueo_caja.png", dark: "/assets/features/arqueo_caja_oscuro.png", alt: "Arqueo de caja" },
      { light: "/assets/features/arqueo_caja2.png", dark: "/assets/features/arqueo_caja_oscuro2.png", alt: "Hist칩rico de arqueos" },
      { light: "/assets/features/arqueo_caja3.png", dark: "/assets/features/arqueo_caja_oscuro3.png", alt: "Detalle de movimientos" },
    ],
    alt:"Gesti칩n de caja",
    mediaAnim:"scale-up",
    contentAnim:"slide-right",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Gesti칩n de Empleados y Roles Personalizados",
    text:"Usuarios, roles, permisos granulares, PIN seguro y registro de ventas por empleado.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/empleados.png", dark: "/assets/features/empleados_oscuro.png", alt: "Listado de empleados" },
      { light: "/assets/features/empleados2.png", dark: "/assets/features/empleados_oscuro2.png", alt: "Roles y permisos" },
    ],
    alt:"Gesti칩n de empleados",
    mediaAnim:"rotate-in",
    contentAnim:"lift-in",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Informes claros y Personalizables",
    text:"Paneles filtrables y m칠tricas clave. Ajusta vistas y compara periodos para tomar decisiones.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/informes.png", dark: "/assets/features/informes_oscuro.png", alt: "Dashboard principal" },
      { light: "/assets/features/informes2.png", dark: "/assets/features/informes_oscuro2.png", alt: "Filtros de informes" },
      { light: "/assets/features/informes3.png", dark: "/assets/features/informes_oscuro3.png", alt: "Detalle por producto" },
      { light: "/assets/features/informes4.png", dark: "/assets/features/informes_oscuro4.png", alt: "Comparativas temporales" },
    ],
    alt:"Panel de informes",
    mediaAnim:"blur-in",
    contentAnim:"fade-in",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  }
];
---
<BaseLayout
  title="TePeuVe"
  description="Interfaz clara, cobros en segundos y control total de inventario. Funciona en PC y tablet."
>
  <HeroDiorama
    title="Software TPV sencillo para tiendas y peque침os negocios"
    subtitle="Vende, gestiona tu inventario y emite tickets y facturas en segundos. TePeuVe es ligero, r치pido y cumple con todas las exigencias de VeriFactu."
    imageSrc="/assets/features/welcome_page.png"
    imageWidth={1200}
    imageHeight={720}
  />

  <FeaturesSection />

  {showcaseItems.map(item => (
    <FeatureShowcaseDynamicRatio items={[item]} />
  ))}

  <VerifactuSection />
  <PricingSection />
  <TeamSection />

<section id="diseno-web" class="section alt defer">
  <div class="container">
    <div class="web-design-inner">
      <h2 class="h2 center">Dise침o de p치ginas web para negocios y pymes</h2>
      <p class="lead center max-680">
        Adem치s, ofrecemos servicio de dise침o de p치ginas web profesionales para negocios y pymes.
        Creamos sitios web claros, r치pidos y f치ciles de usar, pensados para que tus clientes encuentren tu comercio,
        conozcan tus productos y puedan contactarte en pocos clics.
      </p>

      <div class="web-design-grid" role="list">
        <article class="card web-design-card" role="listitem">
          <div class="card-ico web-design-ico" aria-hidden="true">游꿛</div>
          <h3>Dise침o web a medida para tu negocio</h3>
          <p>
            Dise침amos tu p치gina web adaptada a la imagen de tu comercio: colores, logo, estilo visual y textos
            pensados para tu cliente ideal. Tanto si tienes una tienda f칤sica, un servicio local o vendes online,
            creamos una web que transmita confianza y profesionalidad.
          </p>
        </article>

        <article class="card web-design-card" role="listitem">
          <div class="card-ico web-design-ico" aria-hidden="true">游님</div>
          <h3>P치ginas web optimizadas para m칩vil</h3>
          <p>
            Todas nuestras p치ginas web son responsive: se ven y funcionan bien en m칩vil, tablet y ordenador.
            Optimizamos la estructura y el rendimiento para mejorar la experiencia de usuario y el posicionamiento SEO
            de tu negocio local en buscadores como Google.
          </p>
        </article>

        <article class="card web-design-card" role="listitem">
          <div class="card-ico web-design-ico" aria-hidden="true">游눴</div>
          <h3>Precio del dise침o web seg칰n complejidad</h3>
          <p>
            El precio del dise침o de la p치gina web depende de tus necesidades: n칰mero de secciones, cat치logo de productos,
            blog, reservas online, integraci칩n con TPV u otras funciones avanzadas. Cu칠ntanos tu proyecto y te preparamos
            un presupuesto de dise침o web para tu negocio sin compromiso.
          </p>
        </article>
      </div>

      <p class="center web-design-cta">
        <a href="#contacto" class="btn btn-lg">
          Quiero informaci칩n sobre dise침o de p치ginas web
        </a>
      </p>
    </div>
  </div>
</section>

  <FaqSection
    defer={true}
    title="Preguntas frecuentes"
    description="Resolvemos dudas sobre el TPV y VeriFactu."
    items={[
      { question: "쯈u칠 tipo de negocio puede usar TePeuVe?", answer: "Cualquier comercio que necesite un TPV r치pido, intuitivo y con control de inventario, clientes y caja." },
      { question: "쯈u칠 necesito para que funcione?", answer: "Un PC o port치til est치ndar. Te asesoramos si necesitas hardware adicional." },
      { question: "쮺ompatibilidad con perif칠ricos?", answer: "Impresoras de tickets, lectores de c칩digos, balanzas y caj칩n portamonedas autom치tico." },
      { question: "쮿ay permanencia?", answer: "No. Puedes cancelar en cualquier momento." },
      { question: "쯇rueba gratuita?", answer: "S칤, 30 d칤as para evaluar el TPV sin compromiso." },
      { question: "쯉oporte prioritario?", answer: "Disponible en planes Avanzado y Pro." },
      { question: "쮺umplimiento VeriFactu?", answer: "Preparamos integridad, secuencialidad y trazabilidad exigidas." },
      { question: "쮾esti칩n de clientes?", answer: "Registro, historial de compras y fidelizaci칩n configurable." },
      { question: "쮻escuentos y promociones?", answer: "S칤, reglas autom치ticas y precios especiales." },
    ]}
  />

  <ContactSection
    initialStatus={initialStatus}
    initialStatusClass={initialStatusClass}
    endpoint={endpoint}
    turnstileSiteKey={turnstileKey}
  />

  {errCode && (
    <script is:inline>
      const sec = document.getElementById('contacto');
      sec && sec.scrollIntoView({ behavior:'smooth', block:'center' });
      try {
        const u=new URL(location.href);
        u.searchParams.delete('contact_error');
        history.replaceState({},'',u.toString());
      } catch {}
    </script>
  )}

  <script type="module" src="/scripts/features-anim.js"></script>
</BaseLayout>