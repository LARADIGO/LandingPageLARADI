---
import BaseLayout from "@layouts/BaseLayout.astro";
import HeroDiorama from "@components/HeroDiorama.astro";
import FaqSection from "@components/FaqSection.astro";
import FeatureShowcaseDynamicRatio from "@components/FeatureShowcaseDynamicRatio.astro";

const errCode = Astro.url.searchParams.get('contact_error') || '';
const messages: Record<string, string> = {
  MISSING_FIELDS: 'Rellena todos los campos.',
  INVALID_EMAIL: 'El email no parece v√°lido.',
  SERVER_NOT_CONFIGURED: 'Configuraci√≥n del correo incompleta.',
  SES_REJECTED: 'El correo fue rechazado por SES (sandbox o identidad).',
  SES_ACCESS_DENIED: 'Permisos SES insuficientes.',
  BAD_JSON: 'Formato de datos incorrecto.',
  UNSUPPORTED_MEDIA_TYPE: 'Formato de env√≠o no soportado.',
  INTERNAL_ERROR: 'Error interno. Int√©ntalo m√°s tarde.',
  METHOD_NOT_ALLOWED: 'M√©todo no permitido.'
};

const initialStatus = errCode ? (messages[errCode] || 'No se pudo enviar el mensaje.') : '';
const initialStatusClass = errCode ? 'status-error' : '';
---
<BaseLayout
  title="TePeuVe"
  description="Interfaz clara, cobros en segundos y control total de inventario. Funciona en PC y tablet."
>
  <HeroDiorama
    title="El TPV para tu tienda, simple y en regla"
    subtitle="Cobra, emite tickets y facturas, controla inventario y cumple con VeriFactu."
    ctaHref="#contacto"
    cta2Href="#precios"
    imageSrc="/assets/features/welcome_page.png"
    imageWidth={1200}
    imageHeight={720}
  />

  <section id="caracteristicas" class="section">
    <div class="container">
      <h2 class="h2 center">Caracter√≠sticas clave</h2>
      <p class="lead center max-680">Todo lo que necesitas para vender de forma sencilla y sin preocupaciones</p>

      <div class="cards">
        <article class="card">
          <div class="card-ico">üí≥</div>
          <h3>Cobro en segundos</h3>
          <p>Flujo de venta √°gil, atajos de teclado y lector de c√≥digos.</p>
        </article>
        <article class="card">
          <div class="card-ico">üì¶</div>
          <h3>Inventario</h3>
          <p>Variantes, costes y niveles de stock por tienda.</p>
        </article>
        <article class="card">
          <div class="card-ico">üßæ</div>
          <h3>Tickets y cierres</h3>
          <p>Historial, devoluciones, arqueos y exportaci√≥n contable.</p>
        </article>
        <article class="card">
          <div class="card-ico">üìà</div>
          <h3>Informes</h3>
          <p>Ventas por d√≠a, producto y empleado. Descarga a CSV.</p>
        </article>
      </div>
    </div>
  </section>

  <FeatureShowcaseDynamicRatio
    defer={true}
    items={[
      {
        title:"Escoge entre Modo Claro / Modo Oscuro",
        text:"Opta por el modo que mejor se adapte a ti.",
        img:"/assets/features/claro_oscuro.png",
        alt:"Pantalla de venta r√°pida",
        mediaAnim:"zoom-in",
        contentAnim:"slide-left",
        altBg:false,
        mediaWide: true,
        width: 1240,
        height: 760
      },
      {
        title:"Arqueo de Caja",
        text:"Realizalo de forma r√°pida e intuitiva y no dejes que nada se te escape.",
        imgLight:"/assets/features/arqueo_caja.png",
        imgDark:"/assets/features/arqueo_caja_oscuro.png",
        alt:"Gesti√≥n de inventario",
        mediaAnim:"scale-up",
        contentAnim:"slide-right",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760
      },
      {
        title:"Gestiona y Personaliza Empleados",
        text:"Personaliza cada empleado con avatares o fotos reales.",
        imgLight:"/assets/features/empleados.png",
        imgDark:"/assets/features/empleados_oscuro.png",
        alt:"Gesti√≥n de empleados",
        mediaAnim:"rotate-in",
        contentAnim:"lift-in",
        altBg:false,
        mediaWide: true,
        width: 1240,
        height: 760
      },
      {
        title:"Informes claros",
        text:"Ventas por d√≠a, producto y empleado.",
        imgLight:"/assets/features/welcome_page_claro.png",
        imgDark:"/assets/features/welcome_page.png",
        alt:"Informes y anal√≠tica",
        mediaAnim:"blur-in",
        contentAnim:"fade-in",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760
      }
    ]}
  />

  <section id="precios" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Escoge tu plan</h2>
      <div class="pricing-grid">
        <div class="pricing-card featured">
          <h3>Esencial</h3>
          <p class="price"><span>‚Ç¨</span>9,90<span>/mes</span></p>
          <ul>
            <li>1 tienda</li>
            <li>Usuarios limitados</li>
            <li>Soporte por email</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
        <div class="pricing-card featured">
          <h3>Avanzado</h3>
          <p class="price"><span>‚Ç¨</span>12,90<span>/mes</span></p>
          <ul>
            <li>Hasta 3 tiendas</li>
            <li>Inventario avanzado</li>
            <li>Soporte prioritario</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
        <div class="pricing-card featured">
          <h3>Pro</h3>
          <p class="price"><span>‚Ç¨</span>15,90<span>/mes</span></p>
          <ul>
            <li>Tiendas ilimitadas</li>
            <li>Integraciones a medida</li>
            <li>Cuenta dedicada</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
      </div>
    </div>
  </section>

  <section id="verifactu" class="section alt verifactu-section defer">
    <div class="container">
      <h2 class="h2 center">VeriFactu</h2>
      <p class="lead center max-680">Prep√°rate para el sistema de verificaci√≥n fiscal y evita prisas en 2026.</p>
      <div class="cards">
        <article class="card"><div class="card-ico">üõ°Ô∏è</div><h3>¬øQu√© es VeriFactu?</h3><p>Sistema que garantiza integridad y trazabilidad de los registros de facturaci√≥n.</p></article>
        <article class="card"><div class="card-ico">üìÖ</div><h3>Entrada 2026</h3><p>Su obligatoriedad comienza en 2026; anticiparte reduce riesgos y costes.</p></article>
        <article class="card"><div class="card-ico">‚öôÔ∏è</div><h3>Impacto t√©cnico</h3><p>Secuencialidad, firma/hash, almacenamiento seguro y posible env√≠o telem√°tico.</p></article>
      </div>
      <p class="center" style="margin-top:26px;">
        <span class="vf-cta">
          <a class="btn btn-sm" href="https://www2.agenciatributaria.gob.es/wlpl/AVAC-CALC/InformadorVerifactu" target="_blank" rel="noopener">Documentaci√≥n AEAT</a>
          <img src="/assets/logos/aeat.svg" alt="Agencia Tributaria"
               width="28" height="28"
               loading="lazy"
               decoding="async"
               class="vf-cta__logo" />
        </span>
      </p>
    </div>
  </section>

  <section id="sobre" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Qui√©nes somos</h2>
      <p class="lead center max-680">Equipo encargado de que tengas tu TPV y puedas trabajar con √©l de forma sencilla y en regla.</p>
      <div class="cards">
        <article class="card">
          <div class="card-ico">ü§ù</div>
          <h3>Soporte cercano</h3>
          <p>Atenci√≥n y tiempos de respuesta r√°pidos (normalmente en menos de 24h).</p>
        </article>
        <article class="card">
          <div class="card-ico">üõçÔ∏è</div>
          <h3>Experiencia en retail</h3>
          <p>Conocimiento pr√°ctico de caja, inventario y perif√©ricos.</p>
        </article>
        <article class="card">
          <div class="card-ico">üîê</div>
          <h3>Seguridad y cumplimiento</h3>
          <p>Buenas pr√°cticas y alineados con requisitos VeriFactu.</p>
        </article>
        <article class="card">
          <div class="card-ico">üöÄ</div>
          <h3>Evoluci√≥n continua</h3>
          <p>Mejoras frecuentes enfocadas en valor real.</p>
        </article>
      </div>
    </div>
  </section>

  <FaqSection
    defer={true}
    title="Preguntas frecuentes"
    description="Resolvemos dudas sobre el TPV y VeriFactu."
    items={[
      { question: "¬øNecesito hardware especial?", answer: "Funciona con perif√©ricos est√°ndar: lector de c√≥digos, caj√≥n y ticketera." },
      { question: "¬øPuedo importar productos?", answer: "S√≠, mediante plantillas CSV con ayuda inicial si la necesitas." },
      { question: "¬øHay contrato de permanencia?", answer: "No. Puedes cancelar cuando quieras sin penalizaciones." },
      { question: "¬øOfrec√©is soporte prioritario?", answer: "S√≠, en planes avanzados y Pro, con SLA reducido." },
      { question: "¬øCumple con VeriFactu?", answer: "Se prepara para requisitos de integridad, secuencialidad y trazabilidad exigidos." }
    ]}
    data-accordion="false"
    data-persist="true"
    data-icon="chevron"
    data-autoscroll="true"
    data-expand-collapse="true"
    data-counter-target="#faq-count"
    data-default-open="0"
    data-scroll-block="center"
    data-hash-prefix="faq-"
  />

  <section id="contacto" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Contacto</h2>
      <p class="lead center max-680">Cu√©ntanos tus dudas y pregunta lo que necesitas, te responderemos en menos de 24h.</p>
      <form id="contact-form"
            class="form"
            method="POST"
            action={import.meta.env.PUBLIC_CONTACT_ENDPOINT || ''}>
        <p class="hp" aria-hidden="true">
          <label>No rellenar: <input name="hp_field" autocomplete="off" tabindex="-1" /></label>
        </p>
        <div class="form-grid">
          <div>
            <label>Nombre</label>
            <input name="name" type="text" required placeholder="Tu nombre" autocomplete="name" />
          </div>
          <div>
            <label>Email</label>
            <input name="email"
                   type="email"
                   required
                   placeholder="tu@ejemplo.com"
                   autocomplete="email"
                   inputmode="email"
                   pattern="^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$"
                   title="Introduce un email v√°lido (usuario@dominio.ext)" />
          </div>
          <div class="full">
            <label>Mensaje</label>
            <textarea name="message" rows="4" required placeholder="¬øQu√© necesitas?"></textarea>
          </div>
        </div>
        <div id="contact-status"
             class={"muted " + initialStatusClass}
             role="status"
             aria-live="polite"
             style="min-height:1.2em;">
          {initialStatus}
        </div>
        <button type="submit" class="btn btn-lg" data-contact-submit>Enviar</button>
        <noscript><p class="muted">JavaScript desactivado: se usar√° env√≠o directo.</p></noscript>
      </form>
    </div>
  </section>

  {errCode && (
    <script is:inline>
      const sec = document.getElementById('contacto');
      sec && sec.scrollIntoView({ behavior:'smooth', block:'center' });
      try {
        const u=new URL(location.href);
        u.searchParams.delete('contact_error');
        history.replaceState({},'',u.toString());
      } catch {}
    </script>
  )}
</BaseLayout>