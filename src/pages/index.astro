---
import BaseLayout from "@layouts/BaseLayout.astro";
import HeroDiorama from "@components/HeroDiorama.astro";
import FaqSection from "@components/FaqSection.astro";
import FeatureShowcaseDynamicRatio from "@components/FeatureShowcaseDynamicRatio.astro";
import FeaturesSection from "@components/sections/FeaturesSection.astro";
import VerifactuSection from "@components/sections/VerifactuSection.astro";
import PricingSection from "@components/sections/PricingSection.astro";
import TeamSection from "@components/sections/TeamSection.astro";
import ContactSection from "@components/sections/ContactSection.astro";

const errCode = Astro.url.searchParams.get('contact_error') || '';
const messages: Record<string, string> = {
  MISSING_FIELDS: 'Rellena todos los campos.',
  INVALID_EMAIL: 'El email no parece válido.',
  SERVER_NOT_CONFIGURED: 'Configuración del correo incompleta.',
  SES_REJECTED: 'El correo fue rechazado por SES (sandbox o identidad).',
  SES_ACCESS_DENIED: 'Permisos SES insuficientes.',
  BAD_JSON: 'Formato de datos incorrecto.',
  UNSUPPORTED_MEDIA_TYPE: 'Formato de envío no soportado.',
  INTERNAL_ERROR: 'Error interno. Inténtalo más tarde.',
  METHOD_NOT_ALLOWED: 'Método no permitido.'
};
const initialStatus = errCode ? (messages[errCode] || 'No se pudo enviar el mensaje.') : '';
const initialStatusClass = errCode ? 'status-error' : '';
const endpoint = import.meta.env.PUBLIC_CONTACT_ENDPOINT || '';
const turnstileKey = import.meta.env.PUBLIC_TURNSTILE_SITEKEY || '';

// Reutilizamos el mismo array que antes
const showcaseItems = [
  {
    title:"Personalización Total de TePeuVe",
    text:"Adapta TePeuVe a tu forma de trabajar. Elige entre modo claro u oscuro, configura atajos y ajusta cada módulo a tu negocio.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/claro_oscuro.png", dark: "/assets/features/claro_oscuro.png", alt: "Modo claro y oscuro" },
      { light: "/assets/features/ajustes.png", dark: "/assets/features/ajustes_oscuro.png", alt: "Panel de ajustes" },
      { light: "/assets/features/ajustes2.png", dark: "/assets/features/ajustes_oscuro2.png", alt: "Ajustes avanzados" },
      { light: "/assets/features/fidelizacion.png", dark: "/assets/features/fidelizacion_oscuro.png", alt: "Fidelización de clientes" },
    ],
    alt:"Personalización del TPV",
    mediaAnim:"zoom-in",
    contentAnim:"slide-left",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Gestión de Caja y Control de Efectivo",
    text:"Control automático de movimientos y arqueos rápidos. Compatible con cajón portamonedas.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/arqueo_caja.png", dark: "/assets/features/arqueo_caja_oscuro.png", alt: "Arqueo de caja" },
      { light: "/assets/features/arqueo_caja2.png", dark: "/assets/features/arqueo_caja_oscuro2.png", alt: "Histórico de arqueos" },
      { light: "/assets/features/arqueo_caja3.png", dark: "/assets/features/arqueo_caja_oscuro3.png", alt: "Detalle de movimientos" },
    ],
    alt:"Gestión de caja",
    mediaAnim:"scale-up",
    contentAnim:"slide-right",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Gestión de Empleados y Roles Personalizados",
    text:"Usuarios, roles, permisos granulares, PIN seguro y registro de ventas por empleado.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/empleados.png", dark: "/assets/features/empleados_oscuro.png", alt: "Listado de empleados" },
      { light: "/assets/features/empleados2.png", dark: "/assets/features/empleados_oscuro2.png", alt: "Roles y permisos" },
    ],
    alt:"Gestión de empleados",
    mediaAnim:"rotate-in",
    contentAnim:"lift-in",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  },
  {
    title:"Informes claros y Personalizables",
    text:"Paneles filtrables y métricas clave. Ajusta vistas y compara periodos para tomar decisiones.",
    carousel: true,
    carouselImages: [
      { light: "/assets/features/informes.png", dark: "/assets/features/informes_oscuro.png", alt: "Dashboard principal" },
      { light: "/assets/features/informes2.png", dark: "/assets/features/informes_oscuro2.png", alt: "Filtros de informes" },
      { light: "/assets/features/informes3.png", dark: "/assets/features/informes_oscuro3.png", alt: "Detalle por producto" },
      { light: "/assets/features/informes4.png", dark: "/assets/features/informes_oscuro4.png", alt: "Comparativas temporales" },
    ],
    alt:"Panel de informes",
    mediaAnim:"blur-in",
    contentAnim:"fade-in",
    altBg:true,
    mediaWide: true,
    width: 1240,
    height: 760,
    autoplayMs: 4500,
    pauseOnHover: true
  }
];
---
<BaseLayout
  title="TePeuVe"
  description="Interfaz clara, cobros en segundos y control total de inventario. Funciona en PC y tablet."
>
  <HeroDiorama
    title="Software TPV sencillo para tiendas y pequeños negocios"
    subtitle="Vende, gestiona tu inventario y emite tickets y facturas en segundos. TePeuVe es ligero, rápido y cumple con todas las exigencias de VeriFactu."
    imageSrc="/assets/features/welcome_page.png"
    imageWidth={1200}
    imageHeight={720}
  />

  <FeaturesSection />

  {showcaseItems.map(item => (
    <FeatureShowcaseDynamicRatio items={[item]} />
  ))}

  <VerifactuSection />
  <PricingSection />
  <TeamSection />

  <FaqSection
    defer={true}
    title="Preguntas frecuentes"
    description="Resolvemos dudas sobre el TPV y VeriFactu."
    items={[
      { question: "¿Qué tipo de negocio puede usar TePeuVe?", answer: "Cualquier comercio que necesite un TPV rápido, intuitivo y con control de inventario, clientes y caja." },
      { question: "¿Qué necesito para que funcione?", answer: "Un PC o portátil estándar. Te asesoramos si necesitas hardware adicional." },
      { question: "¿Compatibilidad con periféricos?", answer: "Impresoras de tickets, lectores de códigos, balanzas y cajón portamonedas automático." },
      { question: "¿Hay permanencia?", answer: "No. Puedes cancelar en cualquier momento." },
      { question: "¿Prueba gratuita?", answer: "Sí, 30 días para evaluar el TPV sin compromiso." },
      { question: "¿Soporte prioritario?", answer: "Disponible en planes Avanzado y Pro." },
      { question: "¿Cumplimiento VeriFactu?", answer: "Preparamos integridad, secuencialidad y trazabilidad exigidas." },
      { question: "¿Gestión de clientes?", answer: "Registro, historial de compras y fidelización configurable." },
      { question: "¿Descuentos y promociones?", answer: "Sí, reglas automáticas y precios especiales." },
    ]}
  />

  <ContactSection
    initialStatus={initialStatus}
    initialStatusClass={initialStatusClass}
    endpoint={endpoint}
    turnstileSiteKey={turnstileKey}
  />

  {errCode && (
    <script is:inline>
      const sec = document.getElementById('contacto');
      sec && sec.scrollIntoView({ behavior:'smooth', block:'center' });
      try {
        const u=new URL(location.href);
        u.searchParams.delete('contact_error');
        history.replaceState({},'',u.toString());
      } catch {}
    </script>
  )}

  <script type="module" src="/scripts/features-anim.js"></script>
</BaseLayout>