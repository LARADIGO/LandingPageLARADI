---
import BaseLayout from "@layouts/BaseLayout.astro";
import HeroDiorama from "@components/HeroDiorama.astro";
import FaqSection from "@components/FaqSection.astro";
import FeatureShowcaseDynamicRatio from "@components/FeatureShowcaseDynamicRatio.astro";
import AboutSection from "@components/AboutSection.astro";

const errCode = Astro.url.searchParams.get('contact_error') || '';
const messages: Record<string, string> = {
  MISSING_FIELDS: 'Rellena todos los campos.',
  INVALID_EMAIL: 'El email no parece v√°lido.',
  SERVER_NOT_CONFIGURED: 'Configuraci√≥n del correo incompleta.',
  SES_REJECTED: 'El correo fue rechazado por SES (sandbox o identidad).',
  SES_ACCESS_DENIED: 'Permisos SES insuficientes.',
  BAD_JSON: 'Formato de datos incorrecto.',
  UNSUPPORTED_MEDIA_TYPE: 'Formato de env√≠o no soportado.',
  INTERNAL_ERROR: 'Error interno. Int√©ntalo m√°s tarde.',
  METHOD_NOT_ALLOWED: 'M√©todo no permitido.'
};

const initialStatus = errCode ? (messages[errCode] || 'No se pudo enviar el mensaje.') : '';
const initialStatusClass = errCode ? 'status-error' : '';
---
<BaseLayout
  title="TePeuVe"
  description="Interfaz clara, cobros en segundos y control total de inventario. Funciona en PC y tablet."
>
  <HeroDiorama
    title="El TPV para tu tienda, simple y en regla"
    subtitle="Cobra, emite tickets y facturas, controla inventario y cumple con VeriFactu."
    ctaHref="#contacto"
    cta2Href="#precios"
    imageSrc="/assets/features/welcome_page.png"
    imageWidth={1200}
    imageHeight={720}
  />

  <section id="caracteristicas" class="section">
    <div class="container">
      <h2 class="h2 center">Caracter√≠sticas clave</h2>
      <p class="lead center max-680">Todo lo que necesitas para vender de forma sencilla y sin preocupaciones</p>

      <div class="cards">
        <article class="card">
          <div class="card-ico">üí≥</div>
          <h3>Cobro en segundos</h3>
          <p>Flujo de venta √°gil, atajos de teclado y lector de c√≥digos.</p>
        </article>
        <article class="card">
          <div class="card-ico">üì¶</div>
          <h3>Inventario</h3>
          <p>Variantes, costes y niveles de stock por tienda.</p>
        </article>
        <article class="card">
          <div class="card-ico">üßæ</div>
          <h3>Tickets y cierres</h3>
          <p>Historial, devoluciones, arqueos y exportaci√≥n contable.</p>
        </article>
        <article class="card">
          <div class="card-ico">üìà</div>
          <h3>Informes</h3>
          <p>Ventas por d√≠a, producto y empleado. Descarga a CSV.</p>
        </article>
      </div>
    </div>
  </section>

  <FeatureShowcaseDynamicRatio
    defer={true}
    items={[
      {
        title:"Personalizaci√≥n Total de TePeuVe",
        text:"Adapta TePeuVe a tu forma de trabajar. Elige entre modo claro u oscuro, configura atajos de teclado para agilizar tareas y ajusta cada funci√≥n del sistema seg√∫n las necesidades de tu negocio. Activa tu programa de fidelizaci√≥n, personaliza permisos y selecciona entre varios dise√±os de interfaz. Un TPV completamente configurable para que tu comercio trabaje m√°s r√°pido, mejor y a tu manera.",
        carousel: true,
        carouselImages: [
          {
            light: "/assets/features/claro_oscuro.png",
            dark: "/assets/features/claro_oscuro.png",
            alt: "Ajustes de Venta"
          },
          {
            light: "/assets/features/ajustes.png",
            dark: "/assets/features/ajustes_oscuro.png",
            alt: "Ajustes de Venta"
          },
          {
            light: "/assets/features/ajustes2.png",
            dark: "/assets/features/ajustes_oscuro2.png",
            alt: "Ajustes de Venta"
          },
          {
            light: "/assets/features/fidelizacion.png",
            dark: "/assets/features/fidelizacion_oscuro.png",
            alt: "Ajustes de Venta"
          },
        ],
        alt:"Ajustes de Venta",
        mediaAnim:"zoom-in",
        contentAnim:"slide-left",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760,
        autoplayMs: 4500,
        pauseOnHover: true
      },
      {
        title:"Gesti√≥n de Caja y Control de Efectivo",
        text:"TePeuVe facilita el control completo de la caja registrando autom√°ticamente todas las transacciones del d√≠a. Permite un arqueo de caja r√°pido e intuitivo. Adem√°s, el sistema es compatible con cajones portamonedas autom√°ticos, permitiendo abrir el caj√≥n en cada pago en efectivo de forma instant√°nea y segura. Un control de caja eficiente para cualquier comercio que necesite un TPV √°gil y fiable.",
        carousel: true,
        carouselImages: [
          {
            light: "/assets/features/arqueo_caja.png",
            dark: "/assets/features/arqueo_caja_oscuro.png",
            alt: "Operativa de Caja"
          },
          {
            light: "/assets/features/arqueo_caja2.png",
            dark: "/assets/features/arqueo_caja_oscuro2.png",
            alt: "Operativa de Caja"
          },
          {
            light: "/assets/features/arqueo_caja3.png",
            dark: "/assets/features/arqueo_caja_oscuro3.png",
            alt: "Operativa de Caja"
          },
        ],
        alt:"Operativa de Caja",
        mediaAnim:"scale-up",
        contentAnim:"slide-right",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760,
        autoplayMs: 4500,
        pauseOnHover: true
      },
      {
        title:"Gesti√≥n de Empleados y Roles 100% Personalizada",
        text:"Crea y gestiona f√°cilmente a tus empleados en TePeuVe. Asigna a cada trabajador su propio usuario, registra sus ventas y controla permisos mediante roles personalizados. Activa acceso seguro con PIN, elige entre m√∫ltiples avatares o sube una foto personalizada para identificar cada perfil. Una gesti√≥n r√°pida, segura y perfecta para cualquier comercio que necesite un TPV profesional.",
        carousel: true,
        carouselImages: [
          {
            light: "/assets/features/empleados.png",
            dark: "/assets/features/empleados_oscuro.png",
            alt: "Gesti√≥n de empleados"
          },
          {
            light: "/assets/features/empleados2.png",
            dark: "/assets/features/empleados_oscuro2.png",
            alt: "Gesti√≥n de empleados"
          },
        ],
        alt:"Gesti√≥n de empleados",
        mediaAnim:"rotate-in",
        contentAnim:"lift-in",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760,
        autoplayMs: 4500,
        pauseOnHover: true
      },
      {
        title:"Informes claros y Personalizables",
        text:"Obten una visi√≥n r√°pida y intuitiva de los datos de tu negocio. Observa distintos paneles de informes, modifica y filtra los datos",
        carousel: true,
        carouselImages: [
          {
            light: "/assets/features/informes.png",
            dark: "/assets/features/informes_oscuro.png",
            alt: "Dashboard de informes"
          },
          {
            light: "/assets/features/informes2.png",
            dark: "/assets/features/informes_oscuro2.png",
            alt: "Dashboard de informes"
          },
          {
            light: "/assets/features/informes3.png",
            dark: "/assets/features/informes_oscuro3.png",
            alt: "Dashboard de informes"
          },
          {
            light: "/assets/features/informes4.png",
            dark: "/assets/features/informes_oscuro4.png",
            alt: "Dashboard de informes"
          },
        ],
        alt:"Informes y anal√≠tica",
        mediaAnim:"blur-in",
        contentAnim:"fade-in",
        altBg:true,
        mediaWide: true,
        width: 1240,
        height: 760,
        autoplayMs: 4500,
        pauseOnHover: true
      }
    ]}
  />

  <section id="precios" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Escoge tu plan</h2>
      <div class="pricing-grid">
        <div class="pricing-card featured">
          <h3>Esencial</h3>
          <p class="price"><span>‚Ç¨</span>9,90<span>/mes</span></p>
          <ul>
            <li>1 terminal</li>
            <li>Control y arqueo de caja</li>
            <li>Creaci√≥n de Productos y Categor√≠as</li>
            <li>Emisi√≥n y Personalizaci√≥n de Tickets y Facturas</li>
            <li>Soporte por Email</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
        <div class="pricing-card featured">
          <h3>Avanzado</h3>
          <p class="price"><span>‚Ç¨</span>14,90<span>/mes</span></p>
          <ul>
            <li>2 Terminales</li>
            <li>Plan Esencial</li>
            <li>Creaci√≥n y Personalizaci√≥n de empleados</li>
            <li>Control y gesti√≥n de Inventario</li>
            <li>Informes b√°sicos</li>
            <li>Soporte prioritario (&lt;24h)</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
        <div class="pricing-card featured">
          <h3>Pro</h3>
          <p class="price"><span>‚Ç¨</span>19,90<span>/mes</span></p>
          <ul>
            <li>+ de 2 Terminales</li>
            <li>Plan Avanzado</li>
            <li>Informes Avanzados y Personalizables</li>
            <li>Avisos de Bajo Stock</li>
            <li>Creaci√≥n de Clientes y Plan de Fidelizaci√≥n</li>
            <li>Soporte Premium (&lt;2h)</li>
          </ul>
          <a href="#contacto" class="btn btn-block">Contactar</a>
        </div>
      </div>

      <!-- Nota SEO bajo planes (actualizada con icono y encabezado destacado) -->
      <div class="pricing-note" role="note" aria-labelledby="pricing-note-heading">
        <div class="pricing-note__header">
          <span class="pricing-note__icon" aria-hidden="true">üß©</span>
          <span id="pricing-note-heading" class="pricing-note__lead">¬øNecesitas algo distinto?</span>
        </div>
        <p class="pricing-note__text">
          Si ninguno de estos planes se adapta a tu negocio, cont√°ctanos y te prepararemos un plan de TPV a medida:
          integraci√≥n de hardware, m√≥dulos personalizados, adaptaci√≥n VeriFactu y soporte cercano para tu crecimiento.
        </p>
      </div>
    </div>
  </section>

  <section id="verifactu" class="section alt verifactu-section defer">
    <div class="container">
      <h2 class="h2 center">VeriFactu</h2>
      <p class="lead center max-680">Prep√°rate para el sistema de verificaci√≥n fiscal y evita prisas en 2026.</p>
      <div class="cards cards-3">
        <article class="card"><div class="card-ico">üõ°Ô∏è</div><h3>¬øQu√© es VeriFactu?</h3><p>Sistema que garantiza integridad y trazabilidad de los registros de facturaci√≥n.</p></article>
        <article class="card"><div class="card-ico">üìÖ</div><h3>Entrada 2026</h3><p>Su obligatoriedad comienza en 2026; anticiparte reduce riesgos y costes.</p></article>
        <article class="card"><div class="card-ico">‚öôÔ∏è</div><h3>Impacto t√©cnico</h3><p>Secuencialidad, firma/hash, almacenamiento seguro y posible env√≠o telem√°tico.</p></article>
      </div>
      <p class="center" style="margin-top:26px;">
        <span class="vf-cta">
          <a class="btn btn-sm" href="https://www2.agenciatributaria.gob.es/wlpl/AVAC-CALC/InformadorVerifactu" target="_blank" rel="noopener">Documentaci√≥n AEAT</a>
          <img src="/assets/logos/aeat.svg" alt="Agencia Tributaria"
               width="28" height="28"
               loading="lazy"
               decoding="async"
               class="vf-cta__logo" />
        </span>
      </p>
    </div>
  </section>

  <section id="sobre" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Qui√©nes somos</h2>
      <p class="lead center max-680">Equipo encargado de que tengas tu TPV y puedas trabajar con √©l de forma sencilla y en regla.</p>
      <div class="cards">
        <article class="card">
          <div class="card-ico">ü§ù</div>
          <h3>Soporte cercano</h3>
          <p>Atenci√≥n y tiempos de respuesta r√°pidos (normalmente en menos de 24h).</p>
        </article>
        <article class="card">
          <div class="card-ico">üõçÔ∏è</div>
          <h3>Experiencia en retail</h3>
          <p>Conocimiento pr√°ctico de caja, inventario y perif√©ricos.</p>
        </article>
        <article class="card">
          <div class="card-ico">üîê</div>
          <h3>Seguridad y cumplimiento</h3>
          <p>Buenas pr√°cticas y alineados con requisitos VeriFactu.</p>
        </article>
        <article class="card">
          <div class="card-ico">üöÄ</div>
          <h3>Evoluci√≥n continua</h3>
          <p>Mejoras frecuentes enfocadas en valor real.</p>
        </article>
      </div>
    </div>
  </section>

  <FaqSection
    defer={true}
    title="Preguntas frecuentes"
    description="Resolvemos dudas sobre el TPV y VeriFactu."
    items={[
      { question: "¬øQu√© tipo de negocio puede usar TePeuVe?", answer: "TePeuVe est√° dise√±ado para pr√°cticamente cualquier negocio que necesite un TPV f√°cil, intuitivo, r√°pido y completo. Nuestra herramienta se adapta a diferentes sectores permitiendo gestionar ventas, stock, clientes y caja desde un √∫nico lugar." },
      { question: "¬øQu√© necesito para que TePeuVe funcione?", answer: "TePeuVe no exige equipos especiales. Puedes usar casi cualquier ordenador, incluso un port√°til antiguo que ya tengas por casa. Si tienes dudas sobre qu√© equipo es mejor para tu comercio, te asesoramos desde el primer momento: cont√°ctanos y te ayudamos a elegir la opci√≥n m√°s econ√≥mica y eficiente para montar tu TPV." },
      { question: "¬øPuedo conectar una impresora de tickets, lector de c√≥digos o un caj√≥n portamonedas?", answer: "S√≠. TePeuVe es compatible con impresoras de tickets, lectores de c√≥digos de barras, balanzas y cajones portamonedas autom√°ticos." },
      { question: "¬øHay contrato de permanencia?", answer: "No. Puedes cancelar cuando quieras sin penalizaciones." },
      { question: "¬øPuedo probar TePeuVe gratis antes de contratarlo?", answer: "S√≠. TePeuVe ofrece una prueba gratuita de 30 d√≠as para que puedas evaluar todas las funciones del TPV para comercios sin compromiso. Ideal para comprobar si nuestro software TPV encaja con tu negocio antes de suscribirte." },
      { question: "¬øOfrec√©is soporte prioritario?", answer: "S√≠, en planes avanzados y Pro, con tiempos de respuesta reducidos." },
      { question: "¬øCumple con VeriFactu?", answer: "Se prepara para requisitos de integridad, secuencialidad y trazabilidad exigidos." },
      { question: "¬øPuedo gestionar clientes y su historial de compras?", answer: "S√≠. Puedes registrar clientes, ver su historial de compras y activar un programa de fidelizaci√≥n personalizado. Ideal para negocios que quieren potenciar ventas recurrentes y conocer mejor a sus clientes." },
      { question: "¬øEl TPV permite crear descuentos o promociones?", answer: "S√≠. TePeuVe incluye opciones para crear descuentos, promociones autom√°ticas y precios especiales, lo que te permite aumentar ventas en fechas clave o aplicar ofertas espec√≠ficas por producto." },
      { question: "¬øPuedo trabajar con varios empleados, cajas o establecimientos?", answer: "S√≠. Puedes crear usuarios para empleados, asignar roles y permisos, y gestionar m√∫ltiples cajas desde el mismo negocio." },
    ]}
    data-accordion="false"
    data-persist="true"
    data-icon="chevron"
    data-autoscroll="true"
    data-expand-collapse="true"
    data-counter-target="#faq-count"
    data-default-open="0"
    data-scroll-block="center"
    data-hash-prefix="faq-"
  />

  <section id="contacto" class="section alt defer">
    <div class="container">
      <h2 class="h2 center">Contacto</h2>
      <p class="lead center max-680">Cu√©ntanos tus dudas y pregunta lo que necesitas, te responderemos en menos de 24h.</p>
      <form id="contact-form"
            class="form"
            method="POST"
            action={import.meta.env.PUBLIC_CONTACT_ENDPOINT || ''}>
        <p class="hp" aria-hidden="true">
          <label>No rellenar: <input name="hp_field" autocomplete="off" tabindex="-1" /></label>
        </p>
        <div class="form-grid">
          <div>
            <label for="name">Nombre</label>
            <input id="name" name="name" type="text" required placeholder="Tu nombre" autocomplete="name" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email"
                   name="email"
                   type="email"
                   required
                   placeholder="tu@ejemplo.com"
                   autocomplete="email"
                   inputmode="email"
                   pattern="^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$"
                   title="Introduce un email v√°lido (usuario@dominio.ext)" />
          </div>
          <div class="full">
            <label for="message">Mensaje</label>
            <textarea id="message" name="message" rows="4" required placeholder="¬øQu√© necesitas?" spellcheck="true"></textarea>
          </div>
          <div class="full consent-row">
            <label class="consent" for="privacy">
              <input id="privacy" name="privacy" type="checkbox" required />
              <span>Acepto la <a href="/politica-privacidad" target="_blank" rel="noopener">Pol√≠tica de privacidad</a>.</span>
            </label>
          </div>
          <div class="full captcha-wrap">
            <div class="cf-turnstile"
                 data-sitekey={import.meta.env.PUBLIC_TURNSTILE_SITEKEY || ''}
                 data-theme="auto"
                 data-size="normal"></div>
          </div>
        </div>
        <div id="contact-status"
             class={"muted " + initialStatusClass}
             role="status"
             aria-live="polite"
             style="min-height:1.2em;">
          {initialStatus}
        </div>
        <button type="submit" class="btn btn-lg" data-contact-submit>Enviar</button>
        <noscript><p class="muted">JavaScript desactivado: el CAPTCHA no se aplicar√°.</p></noscript>
      </form>
      {/* Script Turnstile (solo si hay sitekey) */}
      {import.meta.env.PUBLIC_TURNSTILE_SITEKEY && (
        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
      )}
    </div>
  </section>

  {errCode && (
    <script is:inline>
      const sec = document.getElementById('contacto');
      sec && sec.scrollIntoView({ behavior:'smooth', block:'center' });
      try {
        const u=new URL(location.href);
        u.searchParams.delete('contact_error');
        history.replaceState({},'',u.toString());
      } catch {}
    </script>
  )}
</BaseLayout>