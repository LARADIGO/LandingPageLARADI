---
import "../styles/feature-showcase.css";

type Side = 'left' | 'right';
type Anim =
  | 'slide-left'
  | 'slide-right'
  | 'slide-up'
  | 'slide-down'
  | 'zoom-in'
  | 'fade-in'
  | 'blur-in'
  | 'rotate-in'
  | 'scale-up'
  | 'lift-in';

interface FeatureItem {
  title: string;
  text: string;
  img: string;
  alt: string;
  side?: Side;
  anim?: Anim;
  mediaAnim?: Anim;
  contentAnim?: Anim;
  altBg?: boolean;
  cover?: boolean; // si deseas desactivar para un caso puntual
}

const {
  title = "Funcionalidades en acción",
  subtitle = "Una vista rápida de cómo te ayuda nuestro TPV",
  items = [] as FeatureItem[]
} = Astro.props;

const defaultAnimCycle: Anim[] = [
  "slide-left","slide-right","slide-up","zoom-in",
  "lift-in","scale-up","rotate-in","blur-in"
];
---

<section id="funcionalidades" class="section features-section full-bleed">
  <div class="container features-head">
    <h2 class="h2 center">{title}</h2>
    {subtitle && <p class="lead center max-680">{subtitle}</p>}
  </div>

  <div class="features-list">
    {
      items.map((it, i) => {
        const side: Side = it.side || (i % 2 === 0 ? 'left' : 'right');
        const baseAnim: Anim = it.anim || defaultAnimCycle[i % defaultAnimCycle.length];
        const mediaAnim: Anim = it.mediaAnim || baseAnim;
        const contentAnim: Anim = it.contentAnim || baseAnim;
        const mediaFirst = side === 'left';
        const fitClass = (it.cover !== false ? 'feature-cover' : 'feature-contain');

        return (
          <article class={`feature-row feature-${side} ${it.altBg ? 'feature-alt' : ''}`} data-index={i}>
            <div class="feature-row-inner">
              {mediaFirst ? (
                <>
                  <div class="feature-media reveal" data-reveal data-anim={mediaAnim} data-stagger="0" style="--stagger-delay:0s;">
                    <div class="feature-media-inner fixed-ratio">
                      <img src={it.img} alt={it.alt} loading="lazy" decoding="async" class={fitClass}/>
                    </div>
                  </div>
                  <div class="feature-content reveal" data-reveal data-anim={contentAnim} data-stagger="1" style="--stagger-delay:0.14s;">
                    <h3>{it.title}</h3>
                    <p>{it.text}</p>
                  </div>
                </>
              ) : (
                <>
                  <div class="feature-content reveal" data-reveal data-anim={contentAnim} data-stagger="0" style="--stagger-delay:0s;">
                    <h3>{it.title}</h3>
                    <p>{it.text}</p>
                  </div>
                  <div class="feature-media reveal" data-reveal data-anim={mediaAnim} data-stagger="1" style="--stagger-delay:0.14s;">
                    <div class="feature-media-inner fixed-ratio">
                      <img src={it.img} alt={it.alt} loading="lazy" decoding="async" class={fitClass}/>
                    </div>
                  </div>
                </>
              )}
            </div>
          </article>
        );
      })
    }
  </div>
</section>

<script is:inline>
  (() => {
    const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const els = document.querySelectorAll('[data-reveal]');
    if (!els.length) return;

    if (reduce) {
      els.forEach(el => el.classList.add('is-visible'));
      return;
    }

    const io = new IntersectionObserver((entries) => {
      for (const e of entries) {
        if (e.isIntersecting) e.target.classList.add('is-visible');
        else e.target.classList.remove('is-visible');
      }
    }, { threshold: 0.25 });

    els.forEach(el => io.observe(el));
  })();
</script>